!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).kbyte={})}(this,function(e){"use strict";var t;t="undefined"!=typeof window?window.WebSocket:require("ws");var n=function(e,t){setTimeout(function(){1===e.readyState?null!==t&&t():n(e,t)},5)},s=function(){function e(e){var n=this;this.address=e,this.ws=new t(e),this.queue={},this.open=!1,this.notifications=function(){},this.ws.addEventListener("message",function(e){var t=JSON.parse(e.data);if(t&&Array.isArray(t)&&2===t.length)if(n.queue[t[1].tag]){var s=t[1].response.error||null,i=s?null:t[1].response,o=n.queue[t[1].tag];delete n.queue[t[1].tag],o(s,i)}else n.notifications(t)}),this.ws.addEventListener("open",function(){n.open=!0}),this.ws.addEventListener("close",function(){n.open=!1})}return e.prototype.subscribe=function(e){this.notifications=e},e.prototype.send=function(e){var t=this;n(this.ws,function(){t.ws.send(JSON.stringify(e))})},e.prototype.request=function(e,t,n){var s={command:e,params:t,tag:Math.random().toString(36).substring(7)};this.queue[s.tag]=n,this.send(["request",s])},e.prototype.respond=function(e,t,n){var s={command:e,tag:t};void 0!==n&&(s.response=n),this.send(["response",s])},e.prototype.error=function(e,t,n){this.respond(e,t,{error:n})},e.prototype.justsaying=function(e,t){var n={subject:e,body:t};this.send(["justsaying",n])},e}();e.Client=s,Object.defineProperty(e,"__esModule",{value:!0})});
