!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ws")):"function"==typeof define&&define.amd?define(["ws"],e):(t=t||self).kbyte=e(t.WebSocket)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e=function(t,n){setTimeout(function(){1===t.readyState?null!==n&&n():e(t,n)},5)};return{Client:function(){function n(e){var n=this;this.address=e,this.ws=new t(e),this.queue={},this.notifications=[],this.open=!1,this.ws.addEventListener("message",function(t){var e=JSON.parse(t.data);if(e&&Array.isArray(e)&&2===e.length)if(n.queue[e[1].tag]){var s=e[1].response.error||null,o=s?null:e[1].response,i=n.queue[e[1].tag];delete n.queue[e[1].tag],i(s,o)}else n.notifications.forEach(function(t){return t(e)})}),this.ws.addEventListener("open",function(){n.open=!0}),this.ws.addEventListener("close",function(){n.open=!1})}return n.prototype.subscribe=function(t){this.notifications.push(t)},n.prototype.send=function(t){var n=this;e(this.ws,function(){n.ws.send(JSON.stringify(t))})},n.prototype.request=function(t,e,n){var s={command:t,params:e,tag:Math.random().toString(36).substring(7)};this.queue[s.tag]=n,this.send(["request",s])},n.prototype.respond=function(t,e,n){var s={command:t,tag:e};void 0!==n&&(s.response=n),this.send(["response",s])},n.prototype.error=function(t,e,n){this.respond(t,e,{error:n})},n.prototype.justsaying=function(t,e){var n={subject:t,body:e};this.send(["justsaying",n])},n}()}});
